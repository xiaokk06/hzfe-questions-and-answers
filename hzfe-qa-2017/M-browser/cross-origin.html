<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>面试题 | HZFE奶库</title>
    <meta name="description" content="前端面试知识题库">
    <link rel="icon" href="/hzfe-questions-and-answers/favicon.ico">
  <link rel="manifest" href="/hzfe-questions-and-answers/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/hzfe-questions-and-answers/icons/apple-touch-icon-152x152.png">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/hzfe-questions-and-answers/assets/css/0.styles.9ba17c25.css" as="style"><link rel="preload" href="/hzfe-questions-and-answers/assets/js/app.01a22e1b.js" as="script"><link rel="preload" href="/hzfe-questions-and-answers/assets/js/47.3882f0d6.js" as="script"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/2.44740bb8.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/3.52166c8d.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/4.d9ea8284.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/5.66c0830c.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/6.2fb8a8cd.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/7.fc2f24a5.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/8.2b8fddf5.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/9.e8725c68.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/10.3ea8bd14.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/11.ff7f7a2b.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/12.3d3272cd.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/13.ed5e9b03.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/14.34e3bfd7.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/15.9385d67d.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/16.eb053bd4.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/17.7be79a98.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/18.77d7d5aa.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/19.60482dab.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/20.38b3d295.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/21.26fab2a4.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/22.64d5b12d.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/23.5e06bad6.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/24.24175e3d.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/25.85db5401.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/26.d3a2b93f.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/27.dfcb0aef.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/28.83dbcc4d.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/29.57e1b2dd.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/30.09a6d5a8.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/31.fb64dbcf.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/32.c6d7e68c.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/33.d0c82836.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/34.0985206e.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/35.8f39b224.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/36.0f607250.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/37.c5b3824e.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/38.bba0091f.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/39.46fb9073.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/40.ce4996ec.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/41.ae462791.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/42.00cd8269.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/43.e19731e7.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/44.68c4c62e.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/45.9c7de21c.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/46.592f90fc.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/48.4a0940d2.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/49.803b2c2e.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/50.78990b60.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/51.7e81e52c.js"><link rel="prefetch" href="/hzfe-questions-and-answers/assets/js/52.cfec2a37.js">
    <link rel="stylesheet" href="/hzfe-questions-and-answers/assets/css/0.styles.9ba17c25.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hzfe-questions-and-answers/" class="home-link router-link-active"><!----> <span class="site-name">HZFE奶库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hzfe-questions-and-answers/toc.html" class="nav-link">目录</a></div><div class="nav-item"><a href="https://hzfe.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HZFE
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/HZFE/hzfe-questions-and-answers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GITHUB
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hzfe-questions-and-answers/toc.html" class="nav-link">目录</a></div><div class="nav-item"><a href="https://hzfe.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  HZFE
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/HZFE/hzfe-questions-and-answers" target="_blank" rel="noopener noreferrer" class="repo-link">
    GITHUB
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>面试题</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/hzfe-questions-and-answers/hzfe-qa-2017/M-browser/cross-origin.html#cors-例子1-简单请求" class="sidebar-link">CORS 例子1: 简单请求</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/hzfe-questions-and-answers/hzfe-qa-2017/M-browser/cross-origin.html#cors-例子2-预检请求" class="sidebar-link">CORS 例子2: 预检请求</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="面试题"><a href="#面试题" aria-hidden="true" class="header-anchor">#</a> 面试题</h1> <ol><li><p>为什么存在跨域这个问题？</p> <p>因为<strong>浏览器</strong>中存在<strong>同源策略</strong></p></li> <li><p>同源策略是什么？为什么要有同源策略？</p> <p>如果两个页面的<strong>协议</strong>，<strong>端口</strong>（如果有指定）和<strong>域名</strong>都相同，则两个页面具有相同的源。浏览器对 JavaScript 实施的安全限制，限制了不同源之间的交互，叫同源策略。这是为了预防某些恶意行为。</p></li> <li><p>跨域有哪些常用方法？</p> <ul><li>jsonp 跨域</li> <li>CORS</li></ul></li></ol> <h1 id="jsonp"><a href="#jsonp" aria-hidden="true" class="header-anchor">#</a> jsonp</h1> <p><code>JSONP</code>: JSON with Padding or JSON-P[1]。他允许绕过同源策略共享数据。但由于固有的不安全性，<code>JSONP</code> 正在被 <code>CORS</code> 所取代。</p> <h3 id="how"><a href="#how" aria-hidden="true" class="header-anchor">#</a> how</h3> <p><strong>如何绕过同源策略？</strong></p> <p>对于每个新的 <code>JSONP</code> 请求，浏览器都必须添加一个新的 <code>&lt;script&gt;</code> 元素，或复用现有的。对于<strong>添加一个新的 <code>&lt;script&gt;</code> 元素</strong>，是通过动态 <code>DOM</code> 操作完成的。将 <code>&lt;script&gt;</code> 元素注入到 HTML DOM 中，并将所需要请求的 URL 赋值给 <code>src</code> 属性。这个 URL 需要携带一个 <code>callback</code> 参数，因此服务器能知道用于包装响应的回调函数名称(JSON 响应和 JSONP 响应的区别就在于， JSONP 响应对象需要作为参数传递给回调函数)。</p> <ol start="0"><li>创建 script 标签，指定 src 属性值，并将该 script 标签嵌入 DOM 中；</li> <li>浏览器立即获取该 script 资源，立即执行资源中代码；</li> <li>执行结果（响应对象）作为参数传递给回调函数（i.e. 资源请求完成时，该回调函数必须已存在于全局作用域中）；</li></ol> <h3 id="why"><a href="#why" aria-hidden="true" class="header-anchor">#</a> why</h3> <p><strong>存在安全隐患，建议使用 <code>CORS</code> 替代。</strong></p> <ul><li><p>不可信的第三方代码</p> <p>使用远程网站的 script 标签会让远程网站得以注入<strong>任何</strong>的内容至网站里。如果远程的网站有 JavaScript 注入漏洞，原来的网站也会受到影响。</p></li> <li><p>回调名称操作和反射文件下载攻击</p> <p>未经把控的回调名称可以被用来传递恶意数据给客户端，绕过 application/json 类型相关的限制，比如2014年反射文件下载（RFD）攻击所示。</p></li> <li><p>跨网站请求伪造 CSRF</p> <p>由于HTML <code>&lt;script&gt;</code> 标签在网络浏览器实现中不遵守同源策略，因此恶意页面可以请求并获取属于其他站点的 JSON 数据。这将允许在恶意页面的上下文中处理这些数据，如果用户当前登录到其他站点，则可能泄漏了密码或其他敏感数据。</p></li></ul> <h1 id="cors"><a href="#cors" aria-hidden="true" class="header-anchor">#</a> CORS</h1> <p>出于安全原因，浏览器限制了从 script 中发起的 cross-origin HTTP 请求。例如 XMLHttpRequest 和 Fetch 等 APIs 遵循同源策略。因此，除非使用 CORS ，否则使用这些 APIs 的应用只能从加载该应用的相同域中，请求 HTTP 资源。</p> <p><code>CORS</code> [Cross-Origin Resource Sharing 跨源资源共享]是一种机制，它的工作原理是，添加额外的 HTTP Headers 来让服务器描述允许使用浏览器读取某一资源的一组 origin 。该机制要求浏览器对可能给服务器数据造成 side-effects 的 HTTP request 进行预检 (preflight) ：使用 HTTP OPTIONS 请求方法从服务器请求回 supported methods 后，在服务器 &quot;approval&quot; 的前提下，使用实际的 HTTP method 来发送 request。</p> <p>需要用到 <code>CORS</code> 的比如有：</p> <ol><li>跨域使用 XMLHttpRequest / Fetch APIs</li> <li>Web 字体（CSS @font-face中的跨域字体）</li> <li>使用 drawImage 绘制到 canvas 的images / video frames</li> <li>WebGL textures ...</li></ol> <h2 id="cors-例子1-简单请求"><a href="#cors-例子1-简单请求" aria-hidden="true" class="header-anchor">#</a> CORS 例子1: 简单请求</h2> <p>不会触发 <code>CORS preflight</code> 的被称为 simple requests，simple request 满足以下特点：</p> <ul><li>GET | HEAD | POST</li> <li>除浏览器自动设置的 Headers ，可以设置以下 Headers（CORS 安全首部字段集合）
<ul><li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Last-Event-ID</li> <li>DPR</li> <li>Save-Data</li> <li>Viewport-Width</li> <li>Width</li> <li>Content-Type
<ul><li>application/x-www-form-urlencoded</li> <li>multipart/form-data</li> <li>text/plain</li></ul></li></ul></li></ul> <p>假设我们有一个跨域 GET 请求：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># request headers</span>
GET /resources/public-data/ HTTP/1.1
<span class="token comment"># ......</span>
Origin: http://foo.example

<span class="token comment"># response headers</span>
HTTP/1.1 200 OK
<span class="token comment"># ......</span>
Access-Control-Allow-Origin: *
</code></pre></div><h2 id="cors-例子2-预检请求"><a href="#cors-例子2-预检请求" aria-hidden="true" class="header-anchor">#</a> CORS 例子2: 预检请求</h2> <p>因为非简单请求可能会影响用户数据，所以他会经过一层 preflight：先通过 OPTIONS method 向另一个域上的资源发送 HTTP request 以确定是否可以安全发送 actual request 。</p> <p>满足以下任何一种情况，则需要 preflight：</p> <ul><li>PUT | DELETE | CONNECT | OPTIONS | TRACE | PATCH</li> <li>前面 simple request 的 headers 列表中没有提到的</li></ul> <p>假设我们有一个跨域 POST 请求，带有复杂请求头：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'X-PINGOTHER'</span><span class="token punctuation">:</span> <span class="token string">'pingpong'</span>
<span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/xml'</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># preflight request headers</span>
OPTIONS /resources/post-here/ HTTP/1.1
<span class="token comment"># ......</span>
Origin: http://foo.example
Access-Control-Request-Method: POST
Access-Control-Request-Headers: X-PINGOTHER, Content-Type

<span class="token comment"># preflight response headers</span>
HTTP/1.1 200 OK
<span class="token comment"># ......</span>
Access-Control-Allow-Origin: http://foo.example
Access-Control-Allow-Methods: POST, GET
Access-Control-Allow-Headers: X-PINGOTHER, Content-Type
Access-Control-Max-Age: 86400

<span class="token comment"># actual request header</span>
POST /resources/post-here/ HTTP/1.1
<span class="token comment"># ......</span>
X-PINGOTHER: pingpong
Content-Type: text/xml<span class="token punctuation">;</span> charset<span class="token operator">=</span>UTF-8
Origin: http://foo.example

<span class="token comment"># actual response header</span>
HTTP/1.1 200 OK
<span class="token comment"># ......</span>
Access-Control-Allow-Origin: http://foo.example
</code></pre></div><h1 id="学习资料"><a href="#学习资料" aria-hidden="true" class="header-anchor">#</a> 学习资料</h1> <p><a href="https://stackoverflow.com/questions/3839966/can-anyone-explain-what-jsonp-is-in-layman-terms" target="_blank" rel="noopener noreferrer">stackoverflow - what is jsonp<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener noreferrer">MDN - CORS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://yincheng.site/cross-domain" target="_blank" rel="noopener noreferrer">同源策略和跨域请求研究<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://juejin.im/post/5a6320d56fb9a01cb64ee191" target="_blank" rel="noopener noreferrer">我知道的跨域与安全<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/HZFE/hzfe-questions-and-answers/edit/master/docs/hzfe-qa-2017/M-browser/cross-origin.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">7/29/2018, 12:21:27 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/hzfe-questions-and-answers/assets/js/47.3882f0d6.js" defer></script><script src="/hzfe-questions-and-answers/assets/js/app.01a22e1b.js" defer></script>
  </body>
</html>
